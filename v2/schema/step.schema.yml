$schema: "http://json-schema.org/draft-07/schema#"
$id: "v2/schema/step.schema.yml"
title: "Step"
type: "object"
description: "Installation step."
properties:
  type:
    type: "string"
    description: "Type of installation step."
    enum:
      - "user_action"
      - "fastboot:reboot_bootloader"
      - "fastboot:update"
      - "systemimage"
      - "fastboot:boot"
      - "fastboot:reboot"
      - "fastboot:continue"
      - "fastboot:erase"
      - "fastboot:format"
      - "fastboot:flash"
      - "fastboot:set_active"
      - "adb:reboot"
      - "adb:format"
      - "adb:sideload"
      - "download"
      - "unpack"
      - "manual_download"
  optional:
    type: "boolean"
    description: "If true, errors in this step will be ignored"
  fallback:
    title: Fallback steps
    type: "array"
    items:
      $ref: "#"
  condition:
    title: Condition
    type: "object"
    description: "Query an installation option to determine if the step should be run"
    properties:
      var:
        title: Property var
        type: "string"
        description: "Reference to an option defined for this operating system"
      value:
        title: Property value
        description: "Value to expect"
    required:
      - "var"
      - "value"
  group:
    type: "string"
    description: "[type: download] [required] Group of files."
  files:
    title: Files
    type: "array"
    description: "[type: download] [required] Array of files to download."
    items:
      title: File
      type: "object"
      properties:
        url:
          type: "string"
          description: "URL of the file to download"
        checksum:
          title: Checksum
          type: "object"
          properties:
            sum:
              title: Hash
              type: "string"
              description: "Checksum of the file to download"
            algorithm:
              title: Hashing algorithm
              type: "string"
              description: "Hashing algorithm to use to calculate the checksum"
  partition:
    title: Partition
    type: "string"
    description: "[type: adb:format] [required] Partition to format."
  action:
    title: User action
    type: "string"
    description: "[type: user_action] [required] user action to run"
  to_state:
    title: To state
    type: "string"
    description: "[type: adb:reboot] [required] State to rebot to."
    enum:
      - "recovery"
      - "system"
      - "bootloader"
required:
  - "type"
